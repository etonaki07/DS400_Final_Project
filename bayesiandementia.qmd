---
title: "Bayesian dementia"
authors: Faith & Elora
format: html
editor: visual
---

# Determining the strongest predictor variables and interactions for early onset dementia.

#### This is the for importing our libraries, data set, cleaning and Bayesian modeling. The document is organized with 4 sections, data cleaning, visual EDA, Bayesian modeling/testing, and then comparison and conclusion.

## 1. Libraries, dataset, and data cleaning.

#### A. libraries

```{r}
library(tidyverse)
library(bayesrules)
library(rstanarm)
library(bayesplot)
library(readr)
library(ggpubr)
```

#### B. Importing datasets and Defining variables

Source of datasets: <https://sites.wustl.edu/oasisbrains/home/oasis-1/>

```{r}
data <- read_csv("merged_oasis_data.csv")
data
```

The variables we will be using are:

-   Age: The age of different subjects with and without signs of dementia.

-   MMSE (Mini-Mental State Examination): A measure used to account for variations in head size by normalizing brain volume using total intracranial volume (TIV).

-   CDR (Clinical Dementia Rating): The CDR scale is used to stage the severity of dementia, with specific scores indicating different levels of cognitive and functional impairment. 0 = nondemented; 0.5 – very mild dementia; 1 = mild dementia; 2 = moderate dementia.  

-   nWBV (Normalized Whole Brain Volume): A 30-point questionnaire used as a screening tool to assess cognitive impairment, measuring aspects like memory, orientation, attention, and language.

#### C. Data Cleaning

```{r}
oasis <- data %>%
  select("Age", "M/F", "CDR", "nWBV", "MMSE") %>%
  na.omit() %>%
  mutate(
    dementia = ifelse(CDR == 0, 0, 1)  
  )
```

```{r}
glimpse(oasis)
```

## 2. Visual EDA/ exploring

#### These will just be some simple plots and charts to understand our variables of interest a little more before we get to modeling. It can also serve to help us make inferences before we get started.

#### A. First I have to change the CDR values from numeric to categorical because theres only 4 different values 235 rows. Ill be able to visualize my data a lot better this way.

```{r}
oasis$dementia <- factor(oasis$dementia,
                       levels= c(0,1),
                       labels= c("<=0.5", "0.5<"))
oasis <- oasis %>% 
  rename('sex' = 'M/F')
```

#### B. Now I can make some visualizations

```{r}
ggplot( data=oasis, aes(x=dementia, y=MMSE, fill=dementia)) +
  geom_boxplot()
```

```{r}
ggplot( data=oasis, aes(x=nWBV, y=Age, color=dementia)) +
 geom_point() +
  geom_smooth() +
  stat_cor()
```

```{r}
ggplot( data=oasis, aes(x=dementia, y=nWBV, fill=dementia)) +
  geom_violin(alpha=0.4)+ geom_boxplot(width=0.2)
```

```{r}
ggplot(oasis, aes(x = dementia, fill = sex)) +
  geom_bar()
```

## 3. Bayesian modeling

#### Before modeling, we need to convert dementia back to numeric (0/1) for logistic regression

```{r}
oasis_model <- oasis %>%
  mutate(
    dementia_numeric = ifelse(dementia == "<=0.5", 0, 1)
  )
```

#### A. Priors 

```{r}
##chart to show distribution of dementia
ggplot(oasis_model, aes(x = dementia)) +
  geom_bar()
```

**Prior Intercept:** To get the best results, I am changing the prior intercept to 0, 1.65, since our data is between 1/2 -2/3 0 ( 0.5\<.)

**Prior slope**: For my slope prior, I have little belief and prior knowledge about what to expect, so I am keeping it weak, 0,1.

#### B. Model 1: Age + MMSE 

```{r}
# Model 1: Age + MMSE
model1 <- stan_glm(
  dementia_numeric ~ Age + MMSE,
  data = oasis_model,
  family = binomial,
  prior_intercept = normal(0, 1.65),
  prior = normal(0, 1, autoscale = TRUE),
  chains = 4,
  iter = 5000*2,
  seed = 84735
)

model1
```

#### C. Model 2: Age + MMSE + nWBV (Adding Brain Volume)

```{r}
# Model 2: Age + MMSE + nWBV
model2 <- stan_glm(
  dementia_numeric ~ Age + MMSE + nWBV,
  data = oasis_model,
  family = binomial,
  prior_intercept = normal(0, 1.65),
  prior = normal(0, 1, autoscale = TRUE),
  chains = 4,
  iter = 5000*2,
  seed = 84735
)

# Summary
model2
```

#### D. Model 3: Full Model (Age + MMSE + nWBV + Sex)

```{r}
model3 <- stan_glm(
  dementia_numeric ~ Age + MMSE + nWBV + sex,
  data = oasis_model,
  family = binomial,
  prior_intercept = normal(0, 1.65),
  prior = normal(0, 1, autoscale = TRUE),
  chains = 4,
  iter = 5000*2,
  seed = 84735
)

model3
```

## 4. Comparison and conclusion
